@using ProjetoWeb.Classes
@{BancoDeDados.DBConnect();}
@{
    Layout = null;
    HttpCookie idCook = new HttpCookie("mmm");
    string cookieValue;
}

<html>
<head>
    <title>Perfil</title>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="~/CSS/style.css">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>
<body style="background-color: #c9c1d6">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <script>
    @{
        idCook = Request.Cookies["userId"];
    }
    </script>
    @if (idCook != null)
    {
        if (string.IsNullOrEmpty(Request.Form["ProfileToGo"]))
        {
            Response.Redirect("index.cshtml");
        }
        cookieValue = Context.Request.Cookies["userId"].Value.Split('=')[1];
        <script>
        @{
            string id = Request.Form["ProfileToGo"];
            Profile profile = BancoDeDados.GetProfile(id);
            if (profile == null)
            {
                if (id == cookieValue)
                {
                    BancoDeDados.CreateProfile(cookieValue);
                    Response.Redirect("EditarPerfil.cshtml");
                }
                else
                {
                    Response.Redirect("index.cshtml");
                }
            }
        }
        </script>
        <div class="container">
            <div class="border-start border-end border-dark shadow" style="background-color: lightgray; width: 100%; height:100vh; margin:0 auto">
                <br>
                    <img class="ProfilePic shadow-lg" src="@profile.imageUrl" alt="ProfilePic" />

                @if (cookieValue == profile.userId)
                {
                    <br />
                    <div style='width:70%; margin: 0 auto; display: block'>
                        <button class="btn btn-light btn-outline-dark shadow" style='float:right;' onclick='window.location.replace("EditarPerfil.cshtml")'>Editar</button>
                    </div>
                    <br />
                }


                <br>
                <div class="border border-dark rounded shadow" style="margin:0 auto; height: 55vh; width:80%; background-color: #EAEAEA">
                    <br>
                    <label class="fs-4 fw-bold" style="padding-left:3%; font-family: 'Century Gothic';">@profile.name</label> <label class="fs-6 fw-lighter text-muted" style="margin-left:1%">@profile.login</label>
                    <p style="padding-left:5%; margin-top:2%; font-family: 'Century Gothic';">@profile.description</p>
                    <form method="post">
                        <input type="hidden" name="profUserId" value="" />
                    </form>
                </div>
            </div>
        </div>
        <script>
            function IndexRedirect() {
                window.location.replace("index.cshtml")
            }
        </script>
    }
    else
    {
        Response.Redirect("LoginPage.cshtml");
    }
</body>
</html>